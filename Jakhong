<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‚Äî Creative Edition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
    :root { color-scheme: light; }
    body { font-family: 'Kanit', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .page { display: none; }
    .page.active { display: block; }
    .menu-item { transition: all .25s ease; }
    .menu-item:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,.08); }
    .menu-item.active { background: linear-gradient(135deg,#3b82f6,#1d4ed8); color: #fff; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.75} }
    .pulse { animation: pulse 1.8s infinite; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
    .fade-in { animation: fadeIn .35s ease }
  </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow-lg sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3">
      <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <div class="flex items-center gap-3">
          <div class="text-4xl">‚öΩ</div>
          <div>
            <h1 class="text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</h1>
            <p class="text-sm text-gray-600">
              ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà
              <button id="btnWeekDown" class="px-2 rounded bg-gray-100 hover:bg-gray-200">‚àí</button>
              <span id="headerWeek" class="font-semibold">1</span>
              <button id="btnWeekUp" class="px-2 rounded bg-gray-100 hover:bg-gray-200">Ôºã</button>
              | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: <span id="headerTime">--:--:--</span>
            </p>
          </div>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <div class="flex items-center gap-2 px-2">
            <div class="w-3 h-3 bg-green-500 rounded-full pulse"></div>
            <span class="text-sm text-gray-600">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
          </div>
          <button id="btnSave" class="text-sm bg-emerald-500 hover:bg-emerald-600 text-white px-3 py-1.5 rounded-lg">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button id="btnExport" class="text-sm bg-sky-500 hover:bg-sky-600 text-white px-3 py-1.5 rounded-lg">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</button>
          <label class="text-sm bg-indigo-500 hover:bg-indigo-600 text-white px-3 py-1.5 rounded-lg cursor-pointer">
            üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
            <input id="importFile" type="file" accept="application/json" class="hidden">
          </label>
          <button id="btnClear" class="text-sm bg-rose-500 hover:bg-rose-600 text-white px-3 py-1.5 rounded-lg">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="bg-white shadow-md">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-3 lg:grid-cols-6 gap-2 py-3">
        <button class="menu-item active bg-gray-50 hover:bg-blue-50 p-3 rounded-xl text-center" data-page="dashboard" id="menu-dashboard">
          <div class="text-2xl mb-1">üè†</div><div class="text-sm font-semibold">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</div>
        </button>
        <button class="menu-item bg-gray-50 hover:bg-blue-50 p-3 rounded-xl text-center" data-page="table" id="menu-table">
          <div class="text-2xl mb-1">üèÜ</div><div class="text-sm font-semibold">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
        </button>
        <button class="menu-item bg-gray-50 hover:bg-blue-50 p-3 rounded-xl text-center" data-page="match" id="menu-match">
          <div class="text-2xl mb-1">‚öΩ</div><div class="text-sm font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•</div>
        </button>
        <button class="menu-item bg-gray-50 hover:bg-blue-50 p-3 rounded-xl text-center" data-page="players" id="menu-players">
          <div class="text-2xl mb-1">üë§</div><div class="text-sm font-semibold">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</div>
        </button>
        <button class="menu-item bg-gray-50 hover:bg-blue-50 p-3 rounded-xl text-center" data-page="teams" id="menu-teams">
          <div class="text-2xl mb-1">‚öôÔ∏è</div><div class="text-sm font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</div>
        </button>
        <button class="menu-item bg-gray-50 hover:bg-blue-50 p-3 rounded-xl text-center" data-page="roster" id="menu-roster">
          <div class="text-2xl mb-1">üìã</div><div class="text-sm font-semibold">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</div>
        </button>
      </div>
    </div>
  </nav>

  <main class="container mx-auto px-4 py-6">

    <!-- Dashboard -->
    <section id="page-dashboard" class="page active fade-in">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-1">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</h2>
        <p class="text-gray-600">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</p>
      </div>

      <!-- Quick Stats -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-2xl shadow p-5 text-center">
          <div class="text-2xl mb-1">üèÜ</div>
          <div class="text-2xl font-bold text-blue-600" id="totalTeams">0</div>
          <div class="text-gray-600 text-sm">‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
        <div class="bg-white rounded-2xl shadow p-5 text-center">
          <div class="text-2xl mb-1">‚öΩ</div>
          <div class="text-2xl font-bold text-green-600" id="totalMatches">0</div>
          <div class="text-gray-600 text-sm">‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
        <div class="bg-white rounded-2xl shadow p-5 text-center">
          <div class="text-2xl mb-1">üë§</div>
          <div class="text-2xl font-bold text-purple-600" id="totalMembers">0</div>
          <div class="text-gray-600 text-sm">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
        <div class="bg-white rounded-2xl shadow p-5 text-center">
          <div class="text-2xl mb-1">üìÖ</div>
          <div class="text-2xl font-bold text-orange-600" id="currentWeekDisplay">1</div>
          <div class="text-gray-600 text-sm">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
        </div>
      </div>

      <!-- Top 3 Teams -->
      <div id="topTeams" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6"></div>

      <!-- Recent Matches -->
      <div class="bg-white rounded-2xl shadow p-5 mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">üóìÔ∏è ‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <div id="recentMatches" class="space-y-3">
          <p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏°‡∏ï‡∏ä‡πå</p>
        </div>
      </div>

      <!-- Recent Activities -->
      <div class="bg-white rounded-2xl shadow p-5">
        <h3 class="text-xl font-bold text-gray-800 mb-4">üìä ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <div id="dashboardActivities" class="space-y-3 max-h-64 overflow-y-auto" aria-live="polite">
          <p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
        </div>
      </div>
    </section>

    <!-- League Table -->
    <section id="page-table" class="page fade-in">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-1">üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
        <p class="text-gray-600">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á</p>
      </div>

      <div class="bg-white rounded-2xl shadow overflow-hidden">
        <div class="bg-gradient-to-r from-blue-800 to-blue-600 text-white p-5">
          <h3 class="text-2xl font-bold text-center" id="tableTitle">JAKHONG LEAGUE 3</h3>
        </div>
        <div class="p-4 overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
              <tr>
                <th class="py-2 px-2 text-center">#</th>
                <th class="py-2 px-2 text-left">‡∏ó‡∏µ‡∏°</th>
                <th class="py-2 px-2 text-center">‡πÅ‡∏Ç‡πà‡∏á</th>
                <th class="py-2 px-2 text-center">‡∏ä‡∏ô‡∏∞</th>
                <th class="py-2 px-2 text-center">‡πÄ‡∏™‡∏°‡∏≠</th>
                <th class="py-2 px-2 text-center">‡πÅ‡∏û‡πâ</th>
                <th class="py-2 px-2 text-center">‡πÑ‡∏î‡πâ</th>
                <th class="py-2 px-2 text-center">‡πÄ‡∏™‡∏µ‡∏¢</th>
                <th class="py-2 px-2 text-center">+/-</th>
                <th class="py-2 px-2 text-center">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                <th class="py-2 px-2 text-center">‡∏ü‡∏≠‡∏£‡πå‡∏°</th>
              </tr>
            </thead>
            <tbody id="leagueTableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Match Recorder -->
    <section id="page-match" class="page fade-in">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-1">‚öΩ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h2>
        <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤/‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏™‡∏Å‡∏≠‡∏£‡πå ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
      </div>

      <div class="bg-white rounded-2xl shadow p-6 max-w-3xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤</label>
            <select id="homeTeamSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤ --</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô</label>
            <select id="awayTeamSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô --</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤</label>
            <input id="homeGoalsInput" type="number" min="0" max="20" value="0" class="w-full p-3 border-2 border-gray-200 rounded-xl text-center focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô</label>
            <input id="awayGoalsInput" type="number" min="0" max="20" value="0" class="w-full p-3 border-2 border-gray-200 rounded-xl text-center focus:border-blue-500">
          </div>
        </div>

        <div class="flex flex-wrap gap-3 justify-center">
          <button id="btnRecordMatch" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•</button>
          <button id="btnAutoWinHome" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl">üè† +1 ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏¢‡πâ‡∏≤</button>
          <button id="btnAutoWinAway" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-xl">üõ´ +1 ‡πÉ‡∏´‡πâ‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô</button>
          <button id="btnAutoDraw" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-xl">‚öñÔ∏è ‡πÄ‡∏™‡∏°‡∏≠ 1‚Äì1</button>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow p-6 mt-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏°‡∏ï‡∏ä‡πå</h3>
        <div id="matchHistory" class="space-y-2 max-h-72 overflow-y-auto">
          <p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏°‡∏ï‡∏ä‡πå</p>
        </div>
      </div>
    </section>

    <!-- Player Statistics -->
    <section id="page-players" class="page fade-in">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-1">üë§ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
        <p class="text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + ‡∏î‡∏π‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß/‡πÅ‡∏≠‡∏™‡∏ã‡∏¥‡∏™‡∏ï‡πå/‡∏Ñ‡∏•‡∏µ‡∏ô‡∏ä‡∏µ‡∏ó</p>
      </div>

      <div class="bg-white rounded-2xl shadow p-6 mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3>
        <div class="max-w-4xl mx-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ó‡∏µ‡∏°</label>
              <select id="playerTeamSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</label>
              <select id="playerNameInput" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô --</option>
              </select>
            </div>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            <button data-stat="goal" class="stat-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-xl">‚öΩ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</button>
            <button data-stat="assist" class="stat-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-xl">üéØ ‡πÅ‡∏≠‡∏™‡∏ã‡∏¥‡∏™‡∏ï‡πå</button>
            <button data-stat="save" class="stat-btn bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-xl">ü•Ö ‡πÄ‡∏ã‡∏ü</button>
            <button data-stat="cleansheet" class="stat-btn bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-xl">üõ°Ô∏è ‡∏Ñ‡∏•‡∏µ‡∏ô‡∏ä‡∏µ‡∏ó</button>
            <button data-stat="yellow" class="stat-btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-xl">üü® ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</button>
            <button data-stat="red" class="stat-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-xl">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á</button>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
        <div class="bg-white rounded-2xl shadow p-5">
          <h3 class="text-xl font-bold text-gray-800 mb-3 text-center">üèÜ ‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß</h3>
          <div id="topScorers" class="space-y-3"><p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p></div>
        </div>
        <div class="bg-white rounded-2xl shadow p-5">
          <h3 class="text-xl font-bold text-gray-800 mb-3 text-center">üéØ ‡πÅ‡∏≠‡∏™‡∏ã‡∏¥‡∏™‡∏ï‡πå‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°</h3>
          <div id="topAssists" class="space-y-3"><p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p></div>
        </div>
        <div class="bg-white rounded-2xl shadow p-5">
          <h3 class="text-xl font-bold text-gray-800 mb-3 text-center">ü•Ö ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°</h3>
          <div id="topGoalkeepers" class="space-y-3"><p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p></div>
        </div>
      </div>
    </section>

    <!-- Team Management -->
    <section id="page-teams" class="page fade-in">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-1">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</h2>
        <p class="text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö‡∏ó‡∏µ‡∏° ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
      </div>

      <div class="bg-white rounded-2xl shadow p-6 mb-6">
        <div class="max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</label>
            <select id="editTeamSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label>
            <input id="teamNameInput" type="text" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
          </div>
        </div>
        <div class="flex flex-wrap gap-3 justify-center mt-4">
          <button id="btnTeamUpdate" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2.5 px-5 rounded-xl">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button id="btnTeamAdd" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2.5 px-5 rounded-xl">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà</button>
          <button id="btnTeamDelete" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2.5 px-5 rounded-xl">üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡∏°</button>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡∏°</h3>
        <div class="max-w-5xl mx-auto">
          <div class="mb-4">
            <label class="block text-sm font-semibold text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
            <select id="memberTeamSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>
            </select>
          </div>

          <div id="memberForm" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                <input id="memberName" type="text" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500">
              </div>
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">‡∏≠‡∏≤‡∏¢‡∏∏ *</label>
                <input id="memberAge" type="number" min="15" max="50" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500">
              </div>
              <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label>
                <select id="memberPosition" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500">
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
                  <option value="goalkeeper">ü•Ö ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π</option>
                  <option value="defender">üõ°Ô∏è ‡∏Å‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á</option>
                  <option value="midfielder">‚öΩ ‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</option>
                  <option value="forward">üéØ ‡∏Å‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
                </select>
              </div>
            </div>
            <div class="flex gap-3 justify-center">
              <button id="btnMemberAdd" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2.5 px-6 rounded-xl">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
              <button id="btnMemberClear" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2.5 px-6 rounded-xl">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
            </div>
          </div>

          <div id="membersDisplay" class="hidden mt-6">
            <div class="flex items-center justify-between mb-3">
              <h4 class="text-lg font-bold text-gray-800">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h4>
              <div class="text-sm font-semibold text-blue-600">‡∏£‡∏ß‡∏° <span id="totalMembersCount">0</span> ‡∏Ñ‡∏ô</div>
            </div>
            <div id="membersList"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Roster -->
    <section id="page-roster" class="page fade-in">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-1">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</h2>
        <p class="text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡∏°</p>
      </div>

      <div class="bg-white rounded-2xl shadow p-6 mb-6">
        <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
          <div class="flex items-center gap-3">
            <label class="text-sm font-semibold text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°:</label>
            <select id="rosterTeamSelect" class="p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
              <option value="all">üë• ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°</option>
            </select>
          </div>
          <button id="addPlayerBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2.5 px-6 rounded-xl">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</button>
        </div>
      </div>

      <div id="addPlayerForm" class="bg-white rounded-2xl shadow p-6 mb-6 hidden">
        <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
        <div class="max-w-4xl mx-auto">
          <div class="mb-4">
            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ó‡∏µ‡∏° *</label>
            <select id="newPlayerTeamSelect" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ --</option>
            </select>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</label>
              <div class="flex flex-col items-center">
                <div id="playerPhotoPreview" class="w-28 h-28 rounded-full overflow-hidden border-4 border-gray-300 mb-3 bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center">
                  <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                </div>
                <input type="file" id="playerPhotoInput" accept="image/*" class="hidden">
                <button type="button" id="btnChoosePhoto" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
                <p class="text-xs text-gray-500 mt-2">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG/PNG ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB</p>
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
              <input id="newPlayerName" type="text" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏≠‡∏≤‡∏¢‡∏∏ *</label>
              <input id="newPlayerAge" type="number" min="15" max="50" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
              <input id="newPlayerBirthdate" type="date" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label>
              <select id="newPlayerPosition" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
                <option value="goalkeeper">ü•Ö ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π</option>
                <option value="defender">üõ°Ô∏è ‡∏Å‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á</option>
                <option value="midfielder">‚öΩ ‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</option>
                <option value="forward">üéØ ‡∏Å‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠</label>
              <input id="newPlayerNumber" type="number" min="1" max="99" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
              <input id="newPlayerPhone" type="tel" placeholder="081-234-5678" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500">
            </div>
          </div>
          <div class="flex gap-3 justify-center mt-4">
            <button id="btnAddNewPlayer" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2.5 px-6 rounded-xl">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</button>
            <button id="btnClearNewPlayer" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2.5 px-6 rounded-xl">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
            <button id="btnCancelNewPlayer" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2.5 px-6 rounded-xl">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>
        </div>
      </div>

      <div id="playersRosterDisplay"></div>
    </section>

  </main>

  <script>
    /* ----------------------- Utilities ----------------------- */
    const STORAGE_KEY = 'football_state_ce_v1';

    function escapeHTML(str = '') {
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }
    function maskPhone(p = '') {
      const d = (''+p).replace(/\\D/g, '');
      if (d.length < 4) return p;
      return 'xxx-xxx-' + d.slice(-4);
    }
    function formatBirthdateShort(birthdate) {
      if (!birthdate) return '';
      const date = new Date(birthdate);
      if (isNaN(date)) return '';
      const dd = String(date.getDate()).padStart(2,'0');
      const mm = String(date.getMonth()+1).padStart(2,'0');
      const yyyy = date.getFullYear() + 543; // ‡∏û.‡∏®.
      return \`\${dd}/\${mm}/\${yyyy}\`;
    }

    /* ----------------------- Data ----------------------- */
    let teams = [
      {
        name: '‡πÅ‡∏°‡∏ô‡πÄ‡∏ä‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏ã‡∏¥‡∏ï‡∏µ‡πâ',
        played:0, wins:0, draws:0, losses:0, points:0, goalsFor:0, goalsAgainst:0, form:[], logo:'',
        members: [
          { id: 1, name: '‡πÄ‡∏≠‡∏≠‡∏£‡πå‡∏•‡∏¥‡∏á ‡∏Æ‡∏≤‡∏•‡∏±‡∏ô‡∏î‡πå', age: 23, position: 'forward', number: 9, phone: '081-234-5678', photo: '', joinDate: '1/1/2567', birthdate: '2000-07-21' },
          { id: 2, name: '‡πÄ‡∏Ñ‡∏ß‡∏¥‡∏ô ‡πÄ‡∏î‡∏≠ ‡∏ö‡∏£‡∏≠‡∏¢‡∏ô‡πå', age: 32, position: 'midfielder', number: 17, phone: '081-234-5679', photo: '', joinDate: '1/1/2567', birthdate: '1991-06-28' }
        ]
      },
      {
        name: '‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏ô‡∏≠‡∏•',
        played:0, wins:0, draws:0, losses:0, points:0, goalsFor:0, goalsAgainst:0, form:[], logo:'',
        members: [
          { id: 3, name: '‡∏ö‡∏π‡∏Ñ‡∏≤‡πÇ‡∏¢ ‡∏ã‡∏≤‡∏Å‡∏≤', age: 22, position: 'forward', number: 7, phone: '081-234-5680', photo: '', joinDate: '1/1/2567', birthdate: '2001-09-05' },
          { id: 4, name: '‡∏°‡∏≤‡∏£‡πå‡∏ï‡∏¥‡∏ô ‡πÄ‡∏≠‡πÄ‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î', age: 25, position: 'midfielder', number: 8, phone: '081-234-5681', photo: '', joinDate: '1/1/2567', birthdate: '1998-08-17' }
        ]
      },
      { name: '‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏π‡∏•', played:0, wins:0, draws:0, losses:0, points:0, goalsFor:0, goalsAgainst:0, form:[], logo:'', members: [] },
      { name: '‡πÄ‡∏ä‡∏•‡∏ã‡∏µ', played:0, wins:0, draws:0, losses:0, points:0, goalsFor:0, goalsAgainst:0, form:[], logo:'', members: [] },
      { name: '‡πÅ‡∏°‡∏ô‡πÄ‡∏ä‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏¢‡∏π‡πÑ‡∏ô‡πÄ‡∏ï‡πá‡∏î', played:0, wins:0, draws:0, losses:0, points:0, goalsFor:0, goalsAgainst:0, form:[], logo:'', members: [] },
      { name: '‡∏ó‡πá‡∏≠‡∏ï‡πÅ‡∏ô‡πà‡∏°', played:0, wins:0, draws:0, losses:0, points:0, goalsFor:0, goalsAgainst:0, form:[], logo:'', members: [] }
    ];
    // ‡πÅ‡∏°‡∏ï‡∏ä‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á (single source of truth)
    let matches = []; // {home, away, hg, ag, week, dateISO}
    let playerStats = {}; // { [playerName]: {team, goals, assists, saves, cleanSheets, yellowCards, redCards} }
    let activities = [];
    let currentWeek = 1;
    let currentPage = 'dashboard';

    /* ----------------------- Time / Header ----------------------- */
    function updateTime() {
      const now = new Date();
      const s = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      const headerTime = document.getElementById('headerTime');
      const headerWeek = document.getElementById('headerWeek');
      if (headerTime) headerTime.textContent = s;
      if (headerWeek) headerWeek.textContent = currentWeek;
    }

    /* ----------------------- Navigation ----------------------- */
    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const page = document.getElementById('page-'+pageName);
      if (page) page.classList.add('active');

      document.querySelectorAll('.menu-item').forEach(btn => btn.classList.remove('active'));
      const menu = document.getElementById('menu-'+pageName);
      if (menu) menu.classList.add('active');

      currentPage = pageName;
      setTimeout(()=>updatePageContent(pageName), 50);
    }
    function updatePageContent(name) {
      switch (name) {
        case 'dashboard': updateDashboard(); break;
        case 'table': updateTable(); break;
        case 'players':
          updatePlayerStatsBlocks();
          updateAllSelects();
          break;
        case 'teams':
          updateAllSelects();
          updateMembersDisplay();
          break;
        case 'roster':
          updatePlayersRoster();
          break;
        case 'match':
          updateAllSelects();
          updateMatchHistory();
          break;
      }
    }

    /* ----------------------- Dashboard ----------------------- */
    function updateDashboard() {
      document.getElementById('totalTeams').textContent = teams.length;
      document.getElementById('totalMatches').textContent = matches.length;
      const totalMembers = teams.reduce((sum,t)=>sum + (t.members?.length || 0), 0);
      document.getElementById('totalMembers').textContent = totalMembers;
      document.getElementById('currentWeekDisplay').textContent = currentWeek;

      updateTopTeams();
      updateDashboardActivities();
      updateRecentMatches();
    }

    function sortTeamsForTable(a, b) {
      if (b.points !== a.points) return b.points - a.points;
      const gdA = a.goalsFor - a.goalsAgainst;
      const gdB = b.goalsFor - b.goalsAgainst;
      if (gdB !== gdA) return gdB - gdA;
      if (b.goalsFor !== a.goalsFor) return b.goalsFor - a.goalsFor;
      if (b.wins !== a.wins) return b.wins - a.wins;
      return a.name.localeCompare(b.name, 'th');
    }

    function updateTopTeams() {
      const container = document.getElementById('topTeams');
      const sorted = [...teams].sort(sortTeamsForTable).slice(0,3);
      if (!matches.length || sorted.every(t => t.points === 0)) {
        container.innerHTML = '<div class="col-span-3 text-center text-gray-500 py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</div>';
        return;
      }
      const medal = ['ü•á','ü•à','ü•â'];
      const ring = ['border-yellow-400 bg-yellow-50','border-gray-400 bg-gray-50','border-orange-400 bg-orange-50'];
      container.innerHTML = sorted.map((t,i)=> {
        return \`
          <div class="border-2 \${ring[i]} rounded-xl p-5 text-center">
            <div class="text-3xl mb-1">\${medal[i]}</div>
            <div class="font-bold text-gray-800 mb-1">\${escapeHTML(t.name)}</div>
            <div class="text-2xl font-bold text-blue-600">\${t.points}</div>
            <div class="text-xs text-gray-500 mt-1">\${t.wins} ‡∏ä‡∏ô‡∏∞ ‚Ä¢ \${t.draws} ‡πÄ‡∏™‡∏°‡∏≠ ‚Ä¢ \${t.losses} ‡πÅ‡∏û‡πâ</div>
          </div>\`
      }).join('');
    }

    function updateDashboardActivities() {
      const container = document.getElementById('dashboardActivities');
      if (!activities.length) {
        container.innerHTML = '<p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>';
        return;
      }
      container.innerHTML = activities.slice(0,8).map(a =>
        \`<div class="bg-gray-50 p-3 rounded-lg text-sm border-l-4 border-blue-500">\${escapeHTML(a)}</div>\`
      ).join('');
    }

    function updateRecentMatches() {
      const container = document.getElementById('recentMatches');
      if (!matches.length) {
        container.innerHTML = '<p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏°‡∏ï‡∏ä‡πå</p>';
        return;
      }
      container.innerHTML = matches.slice(0,6).map(m => {
        const H = teams[m.home]?.name || '‚Äî';
        const A = teams[m.away]?.name || '‚Äî';
        const d = new Date(m.date).toLocaleString('th-TH');
        let tag = '‚öñÔ∏è ‡πÄ‡∏™‡∏°‡∏≠';
        if (m.hg > m.ag) tag = '‚úÖ ‡πÄ‡∏´‡∏¢‡πâ‡∏≤‡∏ä‡∏ô‡∏∞';
        else if (m.hg < m.ag) tag = '‚úÖ ‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô‡∏ä‡∏ô‡∏∞';
        return \`
          <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
            <div class="font-semibold text-gray-800 truncate">\${escapeHTML(H)} <span class="text-gray-500">vs</span> \${escapeHTML(A)}</div>
            <div class="flex items-center gap-3">
              <span class="text-sm bg-blue-600 text-white px-2 py-0.5 rounded">\${m.hg}‚Äì\${m.ag}</span>
              <span class="text-xs text-gray-600">\${tag}</span>
              <span class="text-xs text-gray-400">\${d}</span>
            </div>
          </div>\`;
      }).join('');
    }

    /* ----------------------- Table ----------------------- */
    function updateTable() {
      const tbody = document.getElementById('leagueTableBody');
      const sorted = [...teams].sort(sortTeamsForTable);
      tbody.innerHTML = '';
      sorted.forEach((t, idx) => {
        const pos = idx + 1;
        const gd = t.goalsFor - t.goalsAgainst;
        const gdColor = gd > 0 ? 'text-green-600' : gd < 0 ? 'text-rose-600' : 'text-gray-600';
        const posIcon = pos === 1 ? 'ü•á' : pos === 2 ? 'ü•à' : pos === 3 ? 'ü•â' : '';
        const tr = document.createElement('tr');
        tr.className = pos===1 ? 'bg-yellow-50' : 'hover:bg-blue-50';
        tr.innerHTML = \`
          <td class="py-2 px-2 text-center font-bold \${pos<=3?'text-blue-700':''}">\${pos}<div>\${posIcon}</div></td>
          <td class="py-2 px-2">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full overflow-hidden shadow">
                \${t.logo ? \`<img src="\${t.logo}" class="w-full h-full object-cover" alt="logo">\`
                        : \`<div class="w-full h-full bg-gradient-to-br from-blue-500 to-blue-700 text-white flex items-center justify-center font-bold">\${escapeHTML(t.name.charAt(0))}</div>\`}
              </div>
              <span class="font-semibold truncate">\${escapeHTML(t.name)}</span>
            </div>
          </td>
          <td class="py-2 px-2 text-center font-semibold">\${t.played}</td>
          <td class="py-2 px-2 text-center font-semibold">\${t.wins}</td>
          <td class="py-2 px-2 text-center font-semibold">\${t.draws}</td>
          <td class="py-2 px-2 text-center font-semibold">\${t.losses}</td>
          <td class="py-2 px-2 text-center font-semibold">\${t.goalsFor}</td>
          <td class="py-2 px-2 text-center font-semibold">\${t.goalsAgainst}</td>
          <td class="py-2 px-2 text-center font-semibold \${gdColor}">\${gd>0?'+':''}\${gd}</td>
          <td class="py-2 px-2 text-center">
            <span class="bg-blue-600 text-white px-2 py-0.5 rounded font-bold">\${t.points}</span>
          </td>
          <td class="py-2 px-2 text-center text-xs">\${t.form.slice(-5).join(' ') || '-'}</td>
        \`;
        tbody.appendChild(tr);
      });
    }

    /* ---------- Recompute standings from matches (truth source) ---------- */
    function recomputeTableFromMatches() {
      teams.forEach(t => Object.assign(t, {
        played:0, wins:0, draws:0, losses:0, points:0, goalsFor:0, goalsAgainst:0, form:[]
      }));
      // oldest first to build form history correctly
      matches.slice().reverse().forEach(m => {
        const H = teams[m.home], A = teams[m.away];
        if (!H || !A) return;
        H.played++; A.played++;
        H.goalsFor += m.hg; H.goalsAgainst += m.ag;
        A.goalsFor += m.ag; A.goalsAgainst += m.hg;

        if (m.hg > m.ag) {
          H.wins++; H.points += 3; H.form.push('W');
          A.losses++; A.form.push('L');
        } else if (m.hg < m.ag) {
          A.wins++; A.points += 3; A.form.push('W');
          H.losses++; H.form.push('L');
        } else {
          H.draws++; A.draws++;
          H.points += 1; A.points += 1;
          H.form.push('D'); A.form.push('D');
        }
        H.form = H.form.slice(-10);
        A.form = A.form.slice(-10);
      });
    }

    /* ----------------------- Matches ----------------------- */
    function recordMatch() {
      const homeSel = document.getElementById('homeTeamSelect').value;
      const awaySel = document.getElementById('awayTeamSelect').value;
      const hg = parseInt(document.getElementById('homeGoalsInput').value || '0', 10);
      const ag = parseInt(document.getElementById('awayGoalsInput').value || '0', 10);

      if (homeSel === '' || awaySel === '') return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô');
      if (homeSel === awaySel) return alert('‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô');
      if (hg < 0 || ag < 0) return alert('‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç 0 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ');

      matches.unshift({
        home: parseInt(homeSel,10),
        away: parseInt(awaySel,10),
        hg, ag,
        week: currentWeek,
        date: new Date().toISOString()
      });

      const Hname = teams[homeSel].name, Aname = teams[awaySel].name;
      addActivity(\`\${new Date().toLocaleString('th-TH')}: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• \${Hname} \${hg}-\${ag} \${Aname} [‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà \${currentWeek}]\`);

      recomputeTableFromMatches();
      updateDashboard();
      updateTable();
      updateMatchHistory();
      saveState(); // auto save

      // reset form
      document.getElementById('homeTeamSelect').value = '';
      document.getElementById('awayTeamSelect').value = '';
      document.getElementById('homeGoalsInput').value = 0;
      document.getElementById('awayGoalsInput').value = 0;
      syncHomeAwayDisables();
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    }

    function updateMatchHistory() {
      const box = document.getElementById('matchHistory');
      if (!matches.length) {
        box.innerHTML = '<p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏°‡∏ï‡∏ä‡πå</p>';
        return;
      }
      box.innerHTML = matches.map(m => {
        const H = escapeHTML(teams[m.home]?.name || '');
        const A = escapeHTML(teams[m.away]?.name || '');
        const d = new Date(m.date).toLocaleString('th-TH');
        return \`
          <div class="bg-gray-50 p-3 rounded-lg flex items-center justify-between">
            <div class="font-semibold text-gray-800 truncate">\${H} <span class="text-gray-500">vs</span> \${A}</div>
            <div class="flex items-center gap-3">
              <span class="text-sm bg-blue-600 text-white px-2 py-0.5 rounded">\${m.hg}‚Äì\${m.ag}</span>
              <span class="text-xs text-gray-400">\${d}</span>
            </div>
          </div>\`;
      }).join('');
    }

    function syncHomeAwayDisables() {
      const home = document.getElementById('homeTeamSelect').value;
      const away = document.getElementById('awayTeamSelect').value;
      const homeSel = document.getElementById('homeTeamSelect');
      const awaySel = document.getElementById('awayTeamSelect');

      [...homeSel.options].forEach(opt => opt.disabled = (opt.value !== '' && opt.value === away));
      [...awaySel.options].forEach(opt => opt.disabled = (opt.value !== '' && opt.value === home));
    }

    /* ----------------------- Player Stats ----------------------- */
    function addPlayerStat(statType) {
      const teamIndex = document.getElementById('playerTeamSelect').value;
      const playerName = document.getElementById('playerNameInput').value;

      if (teamIndex === '') return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°');
      if (playerName === '') return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô');

      const teamName = teams[teamIndex].name;
      if (!playerStats[playerName]) {
        playerStats[playerName] = { team: teamName, goals:0, assists:0, saves:0, cleanSheets:0, yellowCards:0, redCards:0 };
      }
      switch (statType) {
        case 'goal': playerStats[playerName].goals++; break;
        case 'assist': playerStats[playerName].assists++; break;
        case 'save': playerStats[playerName].saves++; break;
        case 'cleansheet': playerStats[playerName].cleanSheets++; break;
        case 'yellow': playerStats[playerName].yellowCards++; break;
        case 'red': playerStats[playerName].redCards++; break;
      }
      addActivity(\`\${new Date().toLocaleString('th-TH')}: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ \${playerName} (\${teamName}) ‚Äî \${statType}\`);
      updatePlayerStatsBlocks();
      updateDashboard();
      saveState();
      document.getElementById('playerNameInput').value = '';
    }

    function updatePlayerNameSelect() {
      const teamIndex = document.getElementById('playerTeamSelect').value;
      const sel = document.getElementById('playerNameInput');
      sel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô --</option>';
      if (teamIndex === '') return;
      const team = teams[parseInt(teamIndex,10)];
      if (!team?.members?.length) {
        sel.innerHTML = '<option value="">-- ‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ --</option>';
        return;
      }
      team.members.forEach(m => {
        const opt = document.createElement('option');
        opt.value = m.name;
        opt.textContent = m.number ? \`\${m.name} (#\${m.number})\` : m.name;
        sel.appendChild(opt);
      });
    }

    function listTop(arr, key, accentClass, medalColor='blue') {
      const out = arr
        .filter(([n, s]) => s[key] > 0)
        .sort((a,b)=> b[1][key] - a[1][key])
        .slice(0,5);
      if (!out.length) return '<p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
      return out.map(([name, s], i) => {
        const medal = i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'';
        return \`
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border-l-4 \${accentClass}">
            <div class="flex items-center gap-3">
              <span class="text-lg font-bold text-gray-600">\${i+1}</span>
              <span class="text-xl">\${medal}</span>
              <div>
                <div class="font-semibold text-gray-800">\${escapeHTML(name)}</div>
                <div class="text-xs text-gray-600">\${escapeHTML(s.team)}</div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-lg font-bold text-\${medalColor}-600">\${s[key]}</div>
              <div class="text-[11px] text-gray-500">\${key==='goals'?'‡∏õ‡∏£‡∏∞‡∏ï‡∏π':key==='assists'?'‡πÅ‡∏≠‡∏™‡∏ã‡∏¥‡∏™‡∏ï‡πå': '‡∏Ñ‡∏•‡∏µ‡∏ô‡∏ä‡∏µ‡∏ó'}</div>
            </div>
          </div>\`;
      }).join('');
    }

    function updatePlayerStatsBlocks() {
      const entries = Object.entries(playerStats);
      document.getElementById('topScorers').innerHTML = listTop(entries,'goals','border-blue-500','blue');
      document.getElementById('topAssists').innerHTML = listTop(entries,'assists','border-purple-500','purple');
      document.getElementById('topGoalkeepers').innerHTML = listTop(entries,'cleanSheets','border-green-500','green');
    }

    /* ----------------------- Selects / Roster ----------------------- */
    function updateAllSelects() {
      const ids = ['homeTeamSelect','awayTeamSelect','playerTeamSelect','editTeamSelect','memberTeamSelect','rosterTeamSelect'];
      ids.forEach(id => {
        const sel = document.getElementById(id);
        if (!sel) return;
        const current = sel.value;
        if (id === 'rosterTeamSelect') {
          sel.innerHTML = '<option value="all">üë• ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°</option>';
          teams.forEach((t,i) => sel.innerHTML += \`<option value="\${i}">\${escapeHTML(t.name)} (\${t.members?.length || 0} ‡∏Ñ‡∏ô)</option>\`);
        } else if (id === 'memberTeamSelect') {
          sel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>';
          teams.forEach((t,i) => sel.innerHTML += \`<option value="\${i}">\${escapeHTML(t.name)}</option>\`);
        } else {
          sel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>';
          teams.forEach((t,i) => sel.innerHTML += \`<option value="\${i}">\${escapeHTML(t.name)}</option>\`);
        }
        if ([...sel.options].some(o => o.value === current)) sel.value = current;
      });
      updatePlayerNameSelect();
      syncHomeAwayDisables();
    }

    function createPlayerCard(p) {
      return \`
        <div class="bg-gradient-to-b from-white to-gray-50 rounded-xl shadow p-4 border border-gray-200 flex flex-col relative">
          \${p.number ? \`<div class="absolute top-2 right-2"><span class="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow">#\${p.number}</span></div>\` : ''}
          <div class="text-center mb-2">
            <div class="w-16 h-16 mx-auto rounded-full overflow-hidden border-2 border-blue-200 shadow">
              \${p.photo ? \`<img src="\${p.photo}" alt="\${escapeHTML(p.name)}" class="w-full h-full object-cover">\`
                       : \`<div class="w-full h-full bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center">
                            <svg class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                          </div>\`}
            </div>
          </div>
          <div class="text-center">
            <h4 class="text-sm font-bold text-gray-800 mb-1 leading-tight">\${escapeHTML(p.name)}</h4>
            <div class="text-xs text-gray-600">‡∏≠‡∏≤‡∏¢‡∏∏: \${p.age} ‡∏õ‡∏µ</div>
            \${p.birthdate ? \`<div class="text-[11px] text-gray-500">(\${formatBirthdateShort(p.birthdate)})</div>\` : ''}
            \${p.phone ? \`<div class="text-[11px] text-gray-500 mt-1">\${maskPhone(p.phone)}</div>\` : ''}
          </div>
        </div>\`;
    }

    function updatePlayersRoster() {
      updateAllSelects();
      // team filter
      const filter = document.getElementById('rosterTeamSelect').value || 'all';
      const container = document.getElementById('playersRosterDisplay');

      let all = [];
      if (filter === 'all') {
        teams.forEach((t,ti)=>{
          (t.members||[]).forEach(m => all.push({...m, teamName: t.name, teamIndex: ti, teamLogo: t.logo}));
        });
      } else {
        const ti = parseInt(filter,10);
        (teams[ti]?.members||[]).forEach(m => all.push({...m, teamName: teams[ti].name, teamIndex: ti, teamLogo: teams[ti].logo}));
      }

      if (!all.length) {
        container.innerHTML = \`
          <div class="bg-white rounded-2xl shadow p-8 text-center">
            <div class="text-6xl mb-3">üë§</div>
            <h3 class="text-xl font-bold text-gray-800 mb-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</h3>
            <p class="text-gray-600">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÉ‡∏´‡∏°‡πà</p>
          </div>\`;
        return;
      }

      if (filter === 'all') {
        // group by team
        const map = {};
        all.forEach(p => { (map[p.teamName] ||= []).push(p); });
        container.innerHTML = Object.entries(map).map(([teamName, players]) => {
          const logo = players[0].teamLogo;
          return \`
            <div class="bg-white rounded-2xl shadow p-5 mb-5">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-gray-300">
                  \${logo ? \`<img src="\${logo}" class="w-full h-full object-cover">\`
                        : \`<div class="w-full h-full bg-blue-500 text-white flex items-center justify-center font-bold">\${escapeHTML(teamName.charAt(0))}</div>\`}
                </div>
                <div>
                  <h3 class="text-lg font-bold text-gray-800">\${escapeHTML(teamName)}</h3>
                  <p class="text-gray-600 text-sm">‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ \${players.length} ‡∏Ñ‡∏ô</p>
                </div>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                \${players.map(createPlayerCard).join('')}
              </div>
            </div>\`;
        }).join('');
      } else {
        container.innerHTML = \`
          <div class="bg-white rounded-2xl shadow p-5">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
              \${all.map(createPlayerCard).join('')}
            </div>
          </div>\`;
      }
    }

    /* ----------------------- Team & Member Management ----------------------- */
    function addActivity(msg) {
      activities.unshift(msg);
      activities = activities.slice(0, 100);
    }

    function updateTeam() {
      const idx = document.getElementById('editTeamSelect').value;
      const name = document.getElementById('teamNameInput').value.trim();
      if (idx === '') return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç');
      if (!name) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°');

      const old = teams[idx].name;
      teams[idx].name = name;
      addActivity(\`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡∏° "\${old}" ‡πÄ‡∏õ‡πá‡∏ô "\${name}"\`);
      updateAllSelects(); updateDashboard(); updateTable();
      saveState();
      alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }

    function addNewTeam() {
      const name = document.getElementById('teamNameInput').value.trim();
      if (!name) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°');
      if (teams.some(t => t.name === name)) return alert('‡∏°‡∏µ‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');

      teams.push({ name, played:0,wins:0,draws:0,losses:0,points:0,goalsFor:0,goalsAgainst:0,form:[],logo:'',members:[] });
      addActivity(\`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà "\${name}"\`);
      updateAllSelects(); updateDashboard(); updateTable();
      document.getElementById('teamNameInput').value = '';
      saveState();
      alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }

    function deleteTeam() {
      const idx = document.getElementById('editTeamSelect').value;
      if (idx === '') return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö');
      const team = teams[idx];
      if (!confirm(\`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ó‡∏µ‡∏° "\${team.name}" ?\`)) return;
      // remove matches containing this team
      matches = matches.filter(m => m.home !== +idx && m.away !== +idx);
      teams.splice(idx, 1);
      recomputeTableFromMatches();
      addActivity(\`‡∏•‡∏ö‡∏ó‡∏µ‡∏° "\${team.name}"\`);
      updateAllSelects(); updateDashboard(); updateTable(); updateMatchHistory();
      document.getElementById('editTeamSelect').value = '';
      document.getElementById('teamNameInput').value = '';
      saveState();
      alert('‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }

    function addMember() {
      const tIdx = document.getElementById('memberTeamSelect').value;
      const name = document.getElementById('memberName').value.trim();
      const age = parseInt(document.getElementById('memberAge').value || '0',10);
      const position = document.getElementById('memberPosition').value;
      if (tIdx === '') return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°');
      if (!name || !age || !position) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏ä‡∏∑‡πà‡∏≠/‡∏≠‡∏≤‡∏¢‡∏∏/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');

      const team = teams[tIdx];
      team.members ||= [];
      team.members.push({
        id: Date.now(),
        name, age, position,
        number: null, phone: '', birthdate: '', photo: '',
        joinDate: new Date().toLocaleDateString('th-TH')
      });
      addActivity(\`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å "\${name}" ‡πÉ‡∏ô‡∏ó‡∏µ‡∏° "\${team.name}"\`);
      updateMembersDisplay(); updateDashboard();
      document.getElementById('memberName').value = '';
      document.getElementById('memberAge').value = '';
      document.getElementById('memberPosition').value = '';
      saveState();
      alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }

    function deleteMember(memberId, teamIndex) {
      const team = teams[teamIndex];
      const m = team.members.find(x => x.id === memberId);
      if (!m) return;
      if (!confirm(\`‡∏•‡∏ö "\${m.name}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° "\${team.name}" ?\`)) return;
      team.members = team.members.filter(x => x.id !== memberId);
      addActivity(\`‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å "\${m.name}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏° "\${team.name}"\`);
      updateMembersDisplay(); updateDashboard(); saveState();
    }

    function updateMembersDisplay() {
      const sel = document.getElementById('memberTeamSelect');
      const list = document.getElementById('membersList');
      const total = document.getElementById('totalMembersCount');
      const form = document.getElementById('memberForm');
      const wrap = document.getElementById('membersDisplay');

      if (sel.value === '') {
        form.classList.add('hidden');
        wrap.classList.add('hidden');
        return;
      }
      form.classList.remove('hidden');
      wrap.classList.remove('hidden');

      const team = teams[sel.value];
      team.members ||= [];
      total.textContent = team.members.length;

      if (!team.members.length) {
        list.innerHTML = '<p class="text-gray-500 text-center py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>';
        return;
      }
      list.innerHTML = \`
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
          \${team.members.map(m => {
            const icons = {goalkeeper:'ü•Ö',defender:'üõ°Ô∏è',midfielder:'‚öΩ',forward:'üéØ'};
            const posName = {goalkeeper:'‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π',defender:'‡∏Å‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á',midfielder:'‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á',forward:'‡∏Å‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤'}[m.position]||m.position;
            return \`
            <div class="bg-white rounded-xl shadow p-4 border">
              <div class="text-center mb-2">
                <div class="w-16 h-16 mx-auto rounded-full overflow-hidden border-2 border-gray-300">
                  \${m.photo ? \`<img src="\${m.photo}" class="w-full h-full object-cover">\`
                          : \`<div class="w-full h-full bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center">
                              <svg class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                              </svg>
                            </div>\`}
                </div>
                \${m.number ? \`<div class="mt-1"><span class="bg-blue-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">#\${m.number}</span></div>\` : ''}
              </div>
              <div class="text-center">
                <h4 class="font-bold text-gray-800 mb-1">\${escapeHTML(m.name)}</h4>
                <div class="flex items-center justify-center gap-2 mb-2"><span class="text-xl">\${icons[m.position]||'‚öΩ'}</span><span class="text-sm text-gray-600">\${posName}</span></div>
                <div class="text-sm text-gray-600">‡∏≠‡∏≤‡∏¢‡∏∏: \${m.age} ‡∏õ‡∏µ</div>
                \${m.birthdate ? \`<div class="text-[11px] text-gray-500">(\${formatBirthdateShort(m.birthdate)})</div>\` : ''}
                <div class="mt-2">
                  <button onclick="deleteMember(\${m.id}, \${sel.value})" class="bg-red-500 hover:bg-red-600 text-white text-xs font-bold py-1 px-3 rounded">üóëÔ∏è ‡∏•‡∏ö</button>
                </div>
              </div>
            </div>\`
          }).join('')}
        </div>\`;
    }

    /* ----------------------- Add Player (Roster) ----------------------- */
    function toggleAddPlayerForm() {
      const form = document.getElementById('addPlayerForm');
      const btn = document.getElementById('addPlayerBtn');
      if (form.classList.contains('hidden')) {
        form.classList.remove('hidden');
        btn.textContent = '‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
        btn.className = 'bg-red-500 hover:bg-red-600 text-white font-bold py-2.5 px-6 rounded-xl';
        updateNewPlayerTeamSelect();
      } else {
        form.classList.add('hidden');
        btn.textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤';
        btn.className = 'bg-green-500 hover:bg-green-600 text-white font-bold py-2.5 px-6 rounded-xl';
        clearNewPlayerForm();
      }
    }

    function updateNewPlayerTeamSelect() {
      const sel = document.getElementById('newPlayerTeamSelect');
      sel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ --</option>';
      teams.forEach((t,i)=> sel.innerHTML += \`<option value="\${i}">\${escapeHTML(t.name)}</option>\`);
    }

    function clearNewPlayerForm() {
      document.getElementById('newPlayerTeamSelect').value = '';
      document.getElementById('newPlayerName').value = '';
      document.getElementById('newPlayerAge').value = '';
      document.getElementById('newPlayerBirthdate').value = '';
      document.getElementById('newPlayerPosition').value = '';
      document.getElementById('newPlayerNumber').value = '';
      document.getElementById('newPlayerPhone').value = '';
      document.getElementById('playerPhotoInput').value = '';
      const prev = document.getElementById('playerPhotoPreview');
      prev.innerHTML = \`
        <svg class="w-12 h-12 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>\`;
    }

    function previewPlayerPhoto(input) {
      const prev = document.getElementById('playerPhotoPreview');
      if (input.files && input.files[0]) {
        const file = input.files[0];
        if (file.size > 5*1024*1024) { alert('‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB'); input.value=''; return; }
        if (!file.type.startsWith('image/')) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'); input.value=''; return; }
        const reader = new FileReader();
        reader.onload = e => prev.innerHTML = \`<img src="\${e.target.result}" class="w-full h-full object-cover" alt="photo">\`;
        reader.onerror = () => alert('‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        reader.readAsDataURL(file);
      }
    }

    function addNewPlayer() {
      const teamIndex = document.getElementById('newPlayerTeamSelect').value;
      const name = document.getElementById('newPlayerName').value.trim();
      const age = parseInt(document.getElementById('newPlayerAge').value || '0',10);
      const birthdate = document.getElementById('newPlayerBirthdate').value;
      const position = document.getElementById('newPlayerPosition').value;
      const number = document.getElementById('newPlayerNumber').value;
      const phone = document.getElementById('newPlayerPhone').value.trim();
      const photoInput = document.getElementById('playerPhotoInput');

      if (!teamIndex) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°');
      if (!name) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠');
      if (!age || age < 15 || age > 50) return alert('‡∏≠‡∏≤‡∏¢‡∏∏‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 15‚Äì50 ‡∏õ‡∏µ');
      if (!position) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');

      const ti = parseInt(teamIndex,10);
      const team = teams[ti];
      team.members ||= [];

      if (number) {
        const num = parseInt(number,10);
        if (team.members.some(m=> m.number === num)) return alert(\`‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠ \${num} ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ\`);
      }

      const newPlayer = {
        id: Date.now() + Math.random(),
        name, age, birthdate: birthdate || '', position,
        number: number? parseInt(number,10) : null,
        phone, photo:'', joinDate: new Date().toLocaleDateString('th-TH')
      };

      const finalize = () => {
        team.members.push(newPlayer);
        addActivity(\`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ "\${name}" (\${formatBirthdateShort(birthdate) || '‚Äî'}) ‡πÉ‡∏ô‡∏ó‡∏µ‡∏° "\${team.name}"\`);
        updateDashboard(); updatePlayersRoster(); updateAllSelects(); saveState();
        clearNewPlayerForm(); toggleAddPlayerForm();
        alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      };

      if (photoInput.files && photoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = e => { newPlayer.photo = e.target.result; finalize(); };
        reader.onerror = () => alert('‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        reader.readAsDataURL(photoInput.files[0]);
      } else finalize();
    }

    /* ----------------------- Persistence ----------------------- */
    function saveState() {
      const data = { teams, matches, playerStats, activities, currentWeek };
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch(e) {
        console.error('saveState error', e);
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ (‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°?)');
      }
    }
    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        if (data?.teams) teams = data.teams;
        matches = data.matches || [];
        playerStats = data.playerStats || {};
        activities = data.activities || [];
        currentWeek = data.currentWeek || 1;
        recomputeTableFromMatches();
      } catch(e) {
        console.error('loadState error', e);
      }
    }
    function exportJSON() {
      const blob = new Blob([localStorage.getItem(STORAGE_KEY) || ''], { type:'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'league-data.json';
      a.click();
      URL.revokeObjectURL(a.href);
    }
    function importJSON(file) {
      const reader = new FileReader();
      reader.onload = e => {
        try {
          JSON.parse(e.target.result); // validate
          localStorage.setItem(STORAGE_KEY, e.target.result);
          loadState();
          updateAllSelects(); updateDashboard(); updateTable(); updatePlayerStatsBlocks(); updatePlayersRoster(); updateMatchHistory();
          alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        } catch(err) { alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
      };
      reader.readAsText(file);
    }
    function clearLocal() {
      if (!confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return;
      localStorage.removeItem(STORAGE_KEY);
      // reset (‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°)
      location.reload();
    }

    /* ----------------------- Event Listeners ----------------------- */
    function setupEventListeners() {
      // menu
      document.querySelectorAll('.menu-item').forEach(btn => {
        btn.addEventListener('click', () => showPage(btn.dataset.page));
      });

      // week control
      document.getElementById('btnWeekUp').addEventListener('click', ()=>{ currentWeek++; updateTime(); updateDashboard(); saveState(); });
      document.getElementById('btnWeekDown').addEventListener('click', ()=>{ currentWeek = Math.max(1, currentWeek-1); updateTime(); updateDashboard(); saveState(); });

      // save/export/import/clear
      document.getElementById('btnSave').addEventListener('click', ()=>{ saveState(); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); });
      document.getElementById('btnExport').addEventListener('click', exportJSON);
      document.getElementById('importFile').addEventListener('change', e => { if (e.target.files[0]) importJSON(e.target.files[0]); e.target.value=''; });
      document.getElementById('btnClear').addEventListener('click', clearLocal);

      // match
      document.getElementById('homeTeamSelect').addEventListener('change', syncHomeAwayDisables);
      document.getElementById('awayTeamSelect').addEventListener('change', syncHomeAwayDisables);
      document.getElementById('btnRecordMatch').addEventListener('click', recordMatch);
      // shortcuts
      document.getElementById('btnAutoWinHome').addEventListener('click', ()=>{
        const v = parseInt(document.getElementById('homeGoalsInput').value||'0',10);
        document.getElementById('homeGoalsInput').value = v+1;
      });
      document.getElementById('btnAutoWinAway').addEventListener('click', ()=>{
        const v = parseInt(document.getElementById('awayGoalsInput').value||'0',10);
        document.getElementById('awayGoalsInput').value = v+1;
      });
      document.getElementById('btnAutoDraw').addEventListener('click', ()=>{
        document.getElementById('homeGoalsInput').value = 1;
        document.getElementById('awayGoalsInput').value = 1;
      });

      // players
      document.querySelectorAll('.stat-btn').forEach(btn=>{
        btn.addEventListener('click', ()=> addPlayerStat(btn.dataset.stat));
      });
      document.getElementById('playerTeamSelect').addEventListener('change', updatePlayerNameSelect);

      // members
      document.getElementById('memberTeamSelect').addEventListener('change', updateMembersDisplay);
      document.getElementById('btnMemberAdd').addEventListener('click', addMember);
      document.getElementById('btnMemberClear').addEventListener('click', ()=>{
        document.getElementById('memberName').value = '';
        document.getElementById('memberAge').value = '';
        document.getElementById('memberPosition').value = '';
      });

      // roster add
      document.getElementById('addPlayerBtn').addEventListener('click', toggleAddPlayerForm);
      document.getElementById('btnChoosePhoto').addEventListener('click', ()=> document.getElementById('playerPhotoInput').click());
      document.getElementById('playerPhotoInput').addEventListener('change', e => previewPlayerPhoto(e.target));
      document.getElementById('btnAddNewPlayer').addEventListener('click', addNewPlayer);
      document.getElementById('btnClearNewPlayer').addEventListener('click', clearNewPlayerForm);
      document.getElementById('btnCancelNewPlayer').addEventListener('click', toggleAddPlayerForm);

      document.getElementById('rosterTeamSelect').addEventListener('change', updatePlayersRoster);
    }

    /* ----------------------- Init ----------------------- */
    function init() {
      loadState();
      updateAllSelects();
      recomputeTableFromMatches();
      updateDashboard();
      updateTable();
      updatePlayerStatsBlocks();
      updatePlayersRoster();
      updateMatchHistory();
      updateTime();
      setInterval(updateTime, 1000);
      setupEventListeners();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
